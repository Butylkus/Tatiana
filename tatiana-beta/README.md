# Татьяна
Представьте себе не минуту, что в вашем доме завелась женщина, которая по вашей команде или по расписанию включает и выключает различные электроприборы.

Знакомьтесь - Татьяна!

Простой и понятный программно-аппаратный центр для системы "Умный дом". Скрипт умеет работать с модулями реле, кнопками и даже через web-интерфейс.

На платформе Raspberry Pi 2 и выше поддверживает до 26 устройств. Этого достаточно для управления освещением в трёхкномнатной квартире, например (13 ламп и 13 кнопок). Может включать и выключать питание устройств по расписанию (водонагреватель, например). Умеет показывать данные с датчиков DHT11 и DHT22.

И вообще скрипт няшка =)

Правовая основа
----
Это программный продукт, предназначенный для использования и самостоятельной модификации всеми желающими того членами OpenSource-сообщества. Распространяется по лицензии [GPLv2]().

Идея и базовая реализация: [Алексей Бутылкус](https://vk.com/butpub)
                                             
Многие плюшки веб-интерфейса: [Александр Шнуров](https://vk.com/id206464204)


Как это работает
----
Данный скрипт предназначен для включения и выключения определённых контактов GPIO по плану и/или внешнему сигналу ("железная" кнопка, программный интерфейс, Etc).
В соло-режиме (без веб-интерфейса) скрипт просто работает, обращаясь к своей базе данных и возвращая свои действия в лог commonlog.txt (по умолчанию).


Подготовка к установке
----
Для работы Татьяны необходимы MySQL, Python 3.4+ и модули PyMySQL, threading, Adafruit_DHT:  

    1. sudo apt-get install mysql-server python3 python3-pip  
    2. sudo pip3 install PyMySQL
    3. Adafruit_DHT устанавлвайте согласно [документации](https://learn.adafruit.com/dht-humidity-sensing-on-raspberry-pi-with-gdocs-logging/software-install-updated), за исключением выбора интерпретатора. Вместо python следует вводить python3, иначе модуль по умолчанию установится только для 2 версии Python

Создайте базу данных с названием tatiana, а также пользователя tatiana и паролем tatiana, предоставив этому пользователю базовый доступ. Разумеется, можно менять по своему усмотрению, не забыв прописать соответствующие значения в скрипте config.py.

Импортируйте в базу таблицы из файла tatiana.sql. Можно использовать PHPMyAdmin для вашего удобства.


Установка и настройка главного скрипта
----
Для установки необходимо сделать несколько простых шагов. Приведён пример для путей по умолчанию, их можно менять по своему усмотрению - просто не забудьте изменить настройки в конфигах

    1. mkdir /home/pi/tatiana
    2. chown -R pi:pi /home/pi/tatiana

Загружаем сюда скрипты и лог. Не забудьте сделать скрипты исполняемым (chmod +x).

Скрипт можно добавить в rc.local, но правильным решением будет перевод в режим демона:  

    3. sudo cp /home/pi/tatiana/tatiana.service /lib/systemd/system/tatiana.service  
    4. sudo chmod 644 /lib/systemd/system/tatiana.service  
    5. sudo systemctl daemon-reload  
    6. sudo systemctl enable tatiana.service  

Теперь Татьяна будет работать как демон. Во всех смыслах =)

Скрипт работает с базой данных, поэтому почти вся настройка системы происходит через неё. В будущем будет добавлен веб-конфигуратор.




Установка и настройка веб-интерфейса
----
Скопируйте содержимое frontend2.0 в /var/www/html/ (корень веб-сервера по умолчанию для Raspbian), предварительно очистив целевую папку от предустановленных файлов. Перезапустите Apache или Raspberry целиком.

Проверьте корректность запуска фронтенда, набрав на любом устройстве в вашей домашней сети (ПК, планшет, смартфон) ip-адрес вашей Raspberry. Обычно это 192.168.1.ХХХ. Если ваша Raspberry подключена к монитору или используется удалённый рабочий стол, можно ввести localhost или 127.0.0.1.

Вы должны увидеть страницу авторизации.
